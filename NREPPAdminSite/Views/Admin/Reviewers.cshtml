@*//@model NREPPAdminSite.Models.ReviewersPageModel*@

@{
    ViewBag.Title = "Reviewers";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="page-wrapper">
<h2>@ViewBag.Title</h2>
<div class="row">
    <div class="col-sm-12">
        <ul class="list-inline">
            <li class="col-sm-3">
                <input type="text" class="form-control filter-input" placeholder="First Name" data-fieldname="FirstName" data-column="0">
            </li>
            <li class="col-sm-3" style="padding-bottom: 5px">
                <input type="text" class="form-control filter-input" placeholder="Last Name" data-fieldname="LastName" data-column="1">
            </li>
        </ul>
    </div>
</div>
<div class="row voffset3"></div>
<div>
    <table id="tblReviewers" class="display">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>User Name</th>
                <th>ContractEndDate</th>
                <th>Contract Link</th>
                <th>Action</th>
            </tr>
        </thead>
    </table>
</div>
<div>
    <table id="Reviewertable" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th><a href="#" onclick="openModel('');" />Add Reviewer</th>
            </tr>
        </thead>
    </table>
</div>

    <div id='dialogDiv' class='modal fade' role="dialog" style="border: 1px solid #000000;">
        <div class="modal-dialog" style="width: 93%">
            <div class="modal-content">
                <div id='dialogContent' class="modal-body" style="width: 100%;"></div>
            </div>
        </div>
    </div>

    <script type="text/javascript">

    $(document).ready(function () {

        var reviewerTable = $('#tblReviewers').DataTable({
            sDom: '<"top"pl>it<"clear">',
            ajax: {
                "url": "ReviewersList",
                "type": "POST"
            },
            scrollX: true,
            scrollCollapse: true,
            serverSide: true,
            columns: [
                { "data": "FirstName" },
                { "data": "LastName" },
                { "data": "UserName" },
                { "data": "ContractEndDate" },
                { "data": "docId" },
                { "data": "Action" },
                { "data": "Id" }
            ],
            order: [1, 'asc'],
            columnDefs: [
                { "searchable": false, "targets": 2 },
                { "searchable": false, "targets": 3 },
                {
                    render: function (data, type, row) {
                        return '<a href="/GetFile?FileId="+ row["DocId"]>CA</a>';
                    },
                    "searchable": false,
                    targets: 4
                },
                {
                    render: function (data, type, row) {
                        return '<a href="#" onclick="openModel(' + "'" + row["Id"] + "'" + ');">Edit</a>';
                    },
                    "searchable": false,
                    targets: 5
                },
                
                { visible: false, targets: [6] }
            ],
            tableTools: {
                sRowSelect: "os",
                sRowSelector: 'td:first-child'
            }
        });      
       

        $(".filter-input").on("keyup", function () {
            reviewerTable.column($(this).attr('data-column')).search($(this).val()).draw();
        });
    });

    function bindForm(dialog) {
        $.validator.unobtrusive.parse('form');
        $('form', dialog).submit(function () {
            if ($(this).valid()) {
                var data = $(this).serialize();
                console.log(data);
                var files = $(this).get(0).files;
                data.append("fileCa", files[0]);
                $.ajax({
                    url: this.action,
                    type: this.method,
                    data: $(this).serialize(),
                    success: function (result) {
                        if (result.Status === "Success") {
                            $('#dialogDiv').modal('hide');
                            var table = $('#tblReviewers').dataTable();
                            table.fnDraw();
                        }
                        else {
                            $('#dialogContent').html(result.Errors);
                            bindForm();
                        }
                    }
                });
            }
            return false;
        });
        return false;
    }

    function openModel(id) {
        $.ajaxSetup({ cache: false });
        $('#dialogContent').load("\GetReviewer?id=" + id, function () {
            $('#dialogDiv').modal({
                // backdrop: 'static',
                keyboard: true
            }, 'show');
            bindForm(this);
        });
        return false;
    }
</script>


</div>
